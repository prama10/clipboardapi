<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Clipboard + Download API Test</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 2rem;
            background: #f6f8fa;
            color: #333;
        }

        button {
            padding: 10px 20px;
            margin: 0.5rem 0.5rem 0.5rem 0;
            cursor: pointer;
        }

        .user {
            width: 50%;
            padding: 10px;
            margin: 0.5rem 0;
            font-size: 16px;
            border: 2px solid burlywood;
            background-color: #fff;
        }

        input {
            width: 100%;
            padding: 10px;
            margin: 0.5rem 0;
            font-size: 16px;
        }

        .log {
            border: 1px solid #ccc;
            background: #fff;
            padding: 1rem;
            margin-top: 1rem;
            height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-size: 14px;
        }

        label {
            display: block;
            margin-top: 1rem;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h2>Clipboard + Download API Test</h2>

    <!-- User ID display -->
    <p class="user" id="userId">user-12345</p>

    <!-- Clipboard buttons -->
    <div>
        <button onclick="copyToClipboard()">Copy User ID (Clipboard API)</button>
        <button onclick="copyToClipboardFallback()">Copy User ID (Fallback)</button>
        <button id="toggleBtn" onclick="toggleClipboard()">Disable Clipboard API</button>
        <button onclick="pasteFromClipboard()">Paste from Clipboard</button>
    </div>

    <!-- Paste target -->
    <label for="pasteTarget">Button-triggered paste area:</label>
    <input readonly id="pasteTarget" />

    <!-- Manual input -->
    <label for="manualPaste">Manual paste area:</label>
    <input id="manualPaste" placeholder="Try long-press to paste manually..." />

    <!-- Download test buttons -->
    <h3>Download Tests</h3>
    <div>
        <button onclick="downloadWithAnchor()">Download via Anchor</button>
        <button onclick="downloadWithBlob()">Download via Blob + Fetch</button>
        <button onclick="openInNewTab()">Open in New Tab (PDF Viewer)</button>
    </div>

    <!-- Log output -->
    <p><strong>Logs:</strong></p>
    <div class="log" id="logBox"></div>

    <script>
        const logBox = document.getElementById("logBox");

        function log(msg) {
            logBox.textContent += msg + "\n";
        }

        /* ---------------- Clipboard Functions ---------------- */

        async function copyToClipboard() {
            const value = document.getElementById("userId").innerText.trim();
            if (!navigator.clipboard) {
                log("‚ùå Clipboard API not available. Copy failed.");
                return;
            }
            try {
                await navigator.clipboard.writeText(value);
                log(`‚úÖ [Clipboard API] Copied: ${value}`);
            } catch (err) {
                log(`‚ùå [Clipboard API] Copy failed: ${err.message}`);
            }
        }

        function copyToClipboardFallback() {
            const value = document.getElementById("userId").innerText.trim();
            const textarea = document.createElement("textarea");
            textarea.value = value;
            textarea.style.position = "fixed";
            textarea.style.opacity = "0";
            document.body.appendChild(textarea);
            textarea.select();
            const success = document.execCommand("copy");
            document.body.removeChild(textarea);
            if (success) {
                log(`‚úÖ [Fallback] Copied: ${value}`);
            } else {
                log("‚ùå [Fallback] Copy failed.");
            }
        }

        async function pasteFromClipboard() {
            if (!navigator.clipboard || !window.isSecureContext) {
                log("‚ùå Clipboard API not available or insecure context");
                return;
            }
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById("pasteTarget").value = text;
                log(`‚úÖ Pasted: ${text}`);
            } catch (err) {
                log(`‚ùå Paste failed: ${err.message}`);
            }
        }

        let clipboardDisabled = false;
        const originalClipboard = navigator.clipboard;
        const toggleBtn = document.getElementById("toggleBtn");

        function toggleClipboard() {
            if (!clipboardDisabled) {
                Object.defineProperty(navigator, "clipboard", {
                    value: undefined,
                    configurable: true,
                });
                clipboardDisabled = true;
                toggleBtn.textContent = "Enable Clipboard API";
                log("üö´ Clipboard API disabled (simulated)");
            } else {
                Object.defineProperty(navigator, "clipboard", {
                    value: originalClipboard,
                    configurable: true,
                });
                clipboardDisabled = false;
                toggleBtn.textContent = "Disable Clipboard API";
                log("‚úÖ Clipboard API re-enabled");
            }
        }

        /* ---------------- Download Functions ---------------- */

        const testFileUrl = "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf";

        // 1. Anchor with download attribute
        function downloadWithAnchor() {
            const a = document.createElement("a");
            a.href = testFileUrl;
            a.download = "test-anchor.pdf";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            log("‚ñ∂Ô∏è Tried download via <a download>");
        }

        // 2. Blob + Fetch + ObjectURL
        async function downloadWithBlob() {
            try {
                const res = await fetch(testFileUrl);
                const blob = await res.blob();
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = "test-blob.pdf";
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                log("‚úÖ Download triggered via Blob + Fetch");
            } catch (err) {
                log(`‚ùå Blob download failed: ${err.message}`);
            }
        }

        // 3. Open in new tab (PDF viewer)
        function openInNewTab() {
            window.open(testFileUrl, "_blank");
            log("‚ñ∂Ô∏è Opened PDF in new tab");
        }
    </script>
</body>

</html>
