<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Clipboard API Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        font-family: sans-serif;
        margin: 1rem;
        background: #f6f8fa;
        color: #333;
      }

      h2 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
      }

      .user {
        width: 100%;
        padding: 10px;
        margin: 0.5rem 0;
        font-size: 1rem;
        border: 2px solid burlywood;
        background-color: #fff;
        word-wrap: break-word;
      }

      .button-group {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 1rem;
      }

      button {
        flex: 1 1 auto;
        padding: 10px;
        font-size: 1rem;
        min-width: 160px;
        cursor: pointer;
      }

      label {
        display: block;
        margin-top: 1rem;
        font-weight: bold;
        font-size: 0.95rem;
      }

      input {
        width: 100%;
        padding: 10px;
        margin-top: 0.3rem;
        font-size: 1rem;
      }

      .log {
        border: 1px solid #ccc;
        background: #fff;
        padding: 1rem;
        margin-top: 1rem;
        height: 150px;
        overflow-y: auto;
        white-space: pre-wrap;
        font-size: 0.9rem;
      }
    </style>
  </head>

  <body>
    <h2>üìã Clipboard API Test</h2>

    <!-- User ID display -->
    <p class="user" id="userId">user-12345</p>

    <!-- Button group -->
    <div class="button-group">
      <button onclick="copyToClipboard()">Copy (Clipboard API)</button>
      <button onclick="copyToClipboardFallback()">Copy (Fallback)</button>
      <button id="toggleBtn" onclick="toggleClipboard()">
        Disable Clipboard API
      </button>
      <button onclick="pasteFromClipboard()">Paste from Clipboard</button>
    </div>

    <!-- Paste targets -->
    <label for="pasteTarget">Button-triggered paste area:</label>
    <input readonly id="pasteTarget" />

    <label for="manualPaste">Manual paste area:</label>
    <input id="manualPaste" placeholder="Try long-press to paste manually..." />

    <!-- Logs -->
    <p><strong>Logs:</strong></p>
    <div class="log" id="logBox"></div>

    <script>
      const logBox = document.getElementById("logBox");

      function log(msg) {
        logBox.textContent += msg + "\n";
        logBox.scrollTop = logBox.scrollHeight;
      }

      // Clipboard API copy
      async function copyToClipboard() {
        const value = document.getElementById("userId").textContent.trim();

        if (!navigator.clipboard) {
          log("‚ùå Clipboard API not available. Copy failed.");
          return;
        }

        try {
          await navigator.clipboard.writeText(value);
          log(`‚úÖ [Clipboard API] Copied: ${value}`);
        } catch (err) {
          log(`‚ùå [Clipboard API] Copy failed: ${err.message}`);
        }
      }

      // Fallback using execCommand
      function copyToClipboardFallback() {
        const value = document.getElementById("userId").textContent.trim();
        const textarea = document.createElement("textarea");
        textarea.value = value;
        textarea.style.position = "fixed";
        textarea.style.opacity = "0";
        document.body.appendChild(textarea);
        textarea.select();

        const success = document.execCommand("copy");
        document.body.removeChild(textarea);

        if (success) {
          log(`‚úÖ [Fallback] Copied: ${value}`);
        } else {
          log("‚ùå [Fallback] Copy failed.");
        }
      }

      // Clipboard API paste
      async function pasteFromClipboard() {
        if (!navigator.clipboard || !window.isSecureContext) {
          log("‚ùå Clipboard API not available or insecure context");
          return;
        }

        try {
          const text = await navigator.clipboard.readText();
          document.getElementById("pasteTarget").value = text;
          log(`‚úÖ Pasted: ${text}`);
        } catch (err) {
          log(`‚ùå Paste failed: ${err.message}`);
        }
      }

      // Toggle Clipboard API on/off (simulate WebView restriction)
      let clipboardDisabled = false;
      const originalClipboard = navigator.clipboard;
      const toggleBtn = document.getElementById("toggleBtn");

      function toggleClipboard() {
        if (!clipboardDisabled) {
          Object.defineProperty(navigator, "clipboard", {
            value: undefined,
            configurable: true,
          });
          clipboardDisabled = true;
          toggleBtn.textContent = "Enable Clipboard API";
          log("üö´ Clipboard API disabled (simulated)");
        } else {
          Object.defineProperty(navigator, "clipboard", {
            value: originalClipboard,
            configurable: true,
          });
          clipboardDisabled = false;
          toggleBtn.textContent = "Disable Clipboard API";
          log("‚úÖ Clipboard API re-enabled");
        }
      }
    </script>
  </body>
</html>
