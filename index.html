<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Clipboard + Download Test with Inspector</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 2rem;
            background: #f6f8fa;
            color: #333;
        }

        button {
            padding: 10px 20px;
            margin: 0.5rem 0.5rem 0.5rem 0;
            cursor: pointer;
        }

        .user {
            width: 50%;
            padding: 10px;
            margin: 0.5rem 0;
            font-size: 16px;
            border: 2px solid burlywood;
            background-color: #fff;
        }

        input {
            width: 100%;
            padding: 10px;
            margin: 0.5rem 0;
            font-size: 16px;
        }

        .log {
            border: 1px solid #ccc;
            background: #fff;
            padding: 1rem;
            margin-top: 1rem;
            height: 150px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-size: 14px;
        }

        label {
            display: block;
            margin-top: 1rem;
            font-weight: bold;
        }

        /* Inspector styles */
        #inspectorPanel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 200px;
            background: rgba(0, 0, 0, 0.85);
            color: #0f0;
            font-family: monospace;
            font-size: 12px;
            overflow-y: auto;
            padding: 5px;
            display: none;
            z-index: 9999;
        }

        #inspectorToggle {
            position: fixed;
            bottom: 210px;
            right: 10px;
            z-index: 10000;
            padding: 6px 10px;
            background: #444;
            color: #fff;
            border: none;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <h2>Clipboard + Download Test</h2>

    <!-- User ID display -->
    <p class="user" id="userId">user-12345</p>

    <!-- Buttons -->
    <div>
        <button onclick="copyToClipboard()">Copy User ID (Clipboard API)</button>
        <button onclick="copyToClipboardFallback()">Copy User ID (Fallback)</button>
        <button id="toggleBtn" onclick="toggleClipboard()">Disable Clipboard API</button>
        <button onclick="pasteFromClipboard()">Paste from Clipboard</button>
    </div>

    <!-- Paste target -->
    <label for="pasteTarget">Button-triggered paste area:</label>
    <input readonly id="pasteTarget" />

    <!-- Manual input -->
    <label for="manualPaste">Manual paste area:</label>
    <input id="manualPaste" placeholder="Try long-press to paste manually..." />

    <!-- Download test -->
    <h3>Download Tests</h3>
    <div>
        <button onclick="downloadDirect()">Download (Direct Link)</button>
        <button onclick="downloadBlob()">Download (Blob)</button>
        <button onclick="downloadFetch()">Download (Fetch + Blob)</button>
        <a href="https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf">Simple achor link</a>
    </div>

    <!-- Log output -->
    <p><strong>Logs:</strong></p>
    <div class="log" id="logBox"></div>

    <!-- Inspector -->
    <button id="inspectorToggle">üîç Inspector</button>
    <div id="inspectorPanel"></div>

    <script>
        const logBox = document.getElementById("logBox");

        function log(msg) {
            console.log(msg); // also goes to inspector
            logBox.textContent += msg + "\n";
        }

        /* ---------------- Clipboard API ---------------- */
        async function copyToClipboard() {
            const value = document.getElementById("userId").innerText.trim();
            if (!navigator.clipboard) {
                log("‚ùå Clipboard API not available. Copy failed.");
                return;
            }
            try {
                await navigator.clipboard.writeText(value);
                log(`‚úÖ [Clipboard API] Copied: ${value}`);
            } catch (err) {
                log(`‚ùå [Clipboard API] Copy failed: ${err.message}`);
            }
        }

        function copyToClipboardFallback() {
            const value = document.getElementById("userId").innerText.trim();
            const textarea = document.createElement("textarea");
            textarea.value = value;
            textarea.style.position = "fixed";
            textarea.style.opacity = "0";
            document.body.appendChild(textarea);
            textarea.select();
            const success = document.execCommand("copy");
            document.body.removeChild(textarea);
            if (success) {
                log(`‚úÖ [Fallback] Copied: ${value}`);
            } else {
                log("‚ùå [Fallback] Copy failed.");
            }
        }

        async function pasteFromClipboard() {
            if (!navigator.clipboard || !window.isSecureContext) {
                log("‚ùå Clipboard API not available or insecure context");
                return;
            }
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById("pasteTarget").value = text;
                log(`‚úÖ Pasted: ${text}`);
            } catch (err) {
                log(`‚ùå Paste failed: ${err.message}`);
            }
        }

        let clipboardDisabled = false;
        const originalClipboard = navigator.clipboard;
        const toggleBtn = document.getElementById("toggleBtn");

        function toggleClipboard() {
            if (!clipboardDisabled) {
                Object.defineProperty(navigator, "clipboard", { value: undefined, configurable: true });
                clipboardDisabled = true;
                toggleBtn.textContent = "Enable Clipboard API";
                log("üö´ Clipboard API disabled (simulated)");
            } else {
                Object.defineProperty(navigator, "clipboard", { value: originalClipboard, configurable: true });
                clipboardDisabled = false;
                toggleBtn.textContent = "Disable Clipboard API";
                log("‚úÖ Clipboard API re-enabled");
            }
        }

        /* ---------------- Download Tests ---------------- */
        function downloadDirect() {
            try {
                const link = document.createElement("a");
                link.href = "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf";
                link.download = "dummy-direct.pdf";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                log("‚úÖ Direct download triggered");
            } catch (err) {
                log(`‚ùå Direct download failed: ${err.message}`);
            }
        }

        async function downloadBlob() {
            try {
                const response = await fetch("https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf");
                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url;
                link.download = "dummy-blob.pdf";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                log("‚úÖ Blob download triggered");
            } catch (err) {
                log(`‚ùå Blob download failed: ${err.message}`);
            }
        }

        async function downloadFetch() {
            try {
                const res = await fetch("https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf");
                if (!res.ok) throw new Error("Network response was not ok");
                const blob = await res.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.style.display = "none";
                a.href = url;
                a.download = "dummy-fetch.pdf";
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                log("‚úÖ Fetch+Blob download triggered");
            } catch (err) {
                log(`‚ùå Fetch+Blob download failed: ${err.message}`);
            }
        }

        /* ---------------- Inspector ---------------- */
        const panel = document.getElementById("inspectorPanel");
        const toggleInspectorBtn = document.getElementById("inspectorToggle");

        function logToPanel(msg) {
            panel.innerText += msg + "\n";
            panel.scrollTop = panel.scrollHeight;
        }

        let inspectorActive = false;
        let origConsole = {};
        let origFetch = window.fetch;

        toggleInspectorBtn.onclick = () => {
            inspectorActive = !inspectorActive;
            panel.style.display = inspectorActive ? "block" : "none";
            toggleInspectorBtn.textContent = inspectorActive ? "üõë Close Inspector" : "üîç Inspector";
            if (inspectorActive) enableInspector();
            else disableInspector();
        };

        function enableInspector() {
            ["log", "warn", "error"].forEach(type => {
                origConsole[type] = console[type];
                console[type] = function (...args) {
                    origConsole[type].apply(console, args);
                    logToPanel(`[console.${type}] ${args.map(a => JSON.stringify(a)).join(" ")}`);
                };
            });
            window.onerror = (msg, url, line, col, error) => {
                logToPanel(`‚ùå [onerror] ${msg} @ ${line}:${col}`);
                if (error && error.stack) logToPanel(error.stack);
            };
            window.addEventListener("unhandledrejection", e => {
                logToPanel(`‚ùå [unhandledrejection] ${e.reason}`);
            });
            window.fetch = async (...args) => {
                logToPanel(`üåê [fetch] ${args[0]}`);
                const start = Date.now();
                try {
                    const res = await origFetch(...args);
                    logToPanel(`‚úÖ [fetch] ${res.status} in ${Date.now() - start}ms`);
                    return res;
                } catch (err) {
                    logToPanel(`‚ùå [fetch] Failed: ${err.message}`);
                    throw err;
                }
            };
            logToPanel("üïµÔ∏è Inspector enabled");
        }

        function disableInspector() {
            ["log", "warn", "error"].forEach(type => {
                if (origConsole[type]) console[type] = origConsole[type];
            });
            window.fetch = origFetch;
            logToPanel("üõë Inspector disabled");
        }
    </script>
</body>

</html>
